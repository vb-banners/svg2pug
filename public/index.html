<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- Prevent caching of index.html -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="description" content="SVG2PUG help you convert a SVG snippet to a PUG snippet. Useful for testing out how something would look in PUG vs SVG">
  <meta property="og:title" content="SVG to PUG Converter">
  <meta property="og:site_name" content="SVG2PUG">
  <!-- Signal to password managers: no login forms here -->
  <meta name="1password-ignore" content="true">
  <meta name="bitwarden-ignore" content="true">
  <meta name="lastpass-ignore" content="true">
  <script>
    // Shim for process.versions to prevent pug browserify errors
    if (typeof process === 'undefined') {
      window.process = { versions: { node: '16.0.0' }, env: {} };
    } else if (!process.versions) {
      process.versions = { node: '16.0.0' };
    }
  </script>

  <script defer src="%PUBLIC_URL%/pug.js"></script>
  <script defer src="%PUBLIC_URL%/he.js"></script>
  <script defer src="%PUBLIC_URL%/html-to-jade.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="manifest" href="%PUBLIC_URL%/manifest.json" crossorigin="use-credentials">
  <link rel="icon" type="image/svg+xml" href="%PUBLIC_URL%/favicon.svg">
  <meta name="theme-color" content="#1F242E">
  <script>
    // Global error handler for startup issues
    window.addEventListener('error', function(e) {
      if (e.message && (
        e.message.includes('ResizeObserver loop') || 
        e.message.includes('ResizeObserver loop completed with undelivered notifications') ||
        e.message.includes('ResizeObserver loop limit exceeded')
      )) {
        e.stopImmediatePropagation();
        e.preventDefault();
      }
    }, { capture: true });

    window.onerror = function(msg, url, line, col, error) {
      // Ignore ResizeObserver errors
      if (typeof msg === 'string' && (
        msg.includes('ResizeObserver loop') || 
        msg.includes('ResizeObserver loop completed with undelivered notifications') ||
        msg.includes('ResizeObserver loop limit exceeded')
      )) {
        return true;
      }
      
      // If the app hasn't loaded yet (root is empty), show the error
      const root = document.getElementById('root');
      if (root && root.childElementCount === 0) {
        document.body.innerHTML = '<div style="padding: 20px; color: white; font-family: sans-serif;">' +
          '<h1>Startup Error</h1>' +
          '<p>The application failed to start.</p>' +
          '<pre style="background: #333; padding: 10px; overflow: auto;">' + msg + '\n' + (error ? error.stack : '') + '</pre>' +
          '<button onclick="window.location.reload(true)" style="padding: 10px 20px; cursor: pointer;">Reload Application</button>' +
          '</div>';
        document.body.style.backgroundColor = '#1F242E';
      }
    };
  </script>
  <script>
    // Filter out browser extension errors and ResizeObserver errors from console
    (function() {
      const originalError = console.error;
      console.error = function(...args) {
        const msg = args.join(' ');
        if (msg.includes('content_script') || 
            (msg.includes('Cannot read') && msg.includes('control')) ||
            msg.includes('ResizeObserver loop')) {
          return; // Silently ignore extension errors and ResizeObserver errors
        }
        originalError.apply(console, args);
      };
    })();
  </script>
  <script>
    // Aggressively unregister any existing Service Workers to prevent caching issues
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for(let registration of registrations) {
          console.log('Unregistering Service Worker:', registration);
          registration.unregister();
        }
      }).catch(function(err) {
        console.error('Service Worker unregistration failed:', err);
      });
    }

    // Version check to prevent blank screen from cached old versions
    (function() {
      const APP_VERSION = '0.4.0';
      const STORAGE_KEY = 'html2pug_version';
      
      try {
        const savedVersion = localStorage.getItem(STORAGE_KEY);
        
        if (savedVersion && savedVersion !== APP_VERSION) {
          // New version detected, clear caches and reload
          console.log('New version detected:', savedVersion, '->', APP_VERSION);
          
          // Clear localStorage except version and backups
          const keysToPreserve = [];
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key && key.startsWith('html2pug_backup_')) {
              keysToPreserve.push(key);
            }
          }
          const backups = keysToPreserve.map(k => [k, localStorage.getItem(k)]);
          localStorage.clear();
          backups.forEach(([k, v]) => v && localStorage.setItem(k, v));
          
          localStorage.setItem(STORAGE_KEY, APP_VERSION);
          
          // Reload after clearing
          setTimeout(() => {
            window.location.reload();
          }, 100);
        } else if (!savedVersion) {
          // First time load
          localStorage.setItem(STORAGE_KEY, APP_VERSION);
        }
      } catch (e) {
        console.error('Version check failed:', e);
      }
    })();
  </script>
  <title>SVG to PUG Online Realtime Converter</title>
</head>

<body>
  <noscript>
    You need to enable JavaScript to run this app.
  </noscript>
  <div id="root" class="container-fluid"></div>
  <div id="ad-script"></div>

</body>

</html>
